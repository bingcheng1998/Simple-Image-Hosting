<!DOCTYPE html>
<html>

<head>
    <title>图片上传</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body {
            font-family: sans-serif;
            text-align: center;
            padding: 20px;
        }

        #drop_zone {
            border: 2px dashed #ccc;
            padding: 50px;
            margin: 20px auto;
            max-width: 600px;
        }

        #drop_zone.hover {
            border-color: #007bff;
        }

        #file_input {
            display: none;
        }

        #result {
            margin-top: 20px;
        }

        #result img {
            max-width: 100%;
        }

        #result input {
            width: 100%;
            padding: 10px;
            box-sizing: border-box;
        }

        @media (max-width: 600px) {
            #drop_zone {
                padding: 20px;
            }
        }
    </style>
</head>

<body>
    <h1>图片上传</h1>
    <div id="drop_zone">
        拖拽图片到这里或点击上传
        <input type="file" id="file_input" accept="image/*">
    </div>
    <div id="result"></div>

    <script>
        const dropZone = document.getElementById('drop_zone');
        const fileInput = document.getElementById('file_input');
        const result = document.getElementById('result');

        // 拖拽处理
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, preventDefaults, false);
        });
        function preventDefaults(e) { e.preventDefault(); e.stopPropagation(); }
        dropZone.addEventListener('dragenter', () => dropZone.classList.add('hover'));
        dropZone.addEventListener('dragleave', () => dropZone.classList.remove('hover'));
        dropZone.addEventListener('drop', handleDrop, false);
        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            handleFiles(files);
        }

        // 点击上传处理
        dropZone.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', () => handleFiles(fileInput.files));

        // 上传图片
        function handleFiles(files) {
            const formData = new FormData();
            formData.append('file', files[0]);
            fetch('/upload', { method: 'POST', body: formData, headers: { 'Authorization': 'Basic ' + btoa('{{ username }}:{{ password }}') } })
                .then(response => response.json())
                .then(data => {
                    result.innerHTML = `
                        <input type="text" value="${window.location.origin}/images/${data.id}" readonly>
                        <img src="/images/${data.id}">
                    `;
                })
                .catch(error => console.error('Error:', error));
        }
    </script>
</body>

</html>